<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>IPCAS 视觉与注意课题组 在线招募平台</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- <div class="bg-orbit"></div> -->
    <header class="site-header">
      <div>
        <p class="eyebrow">中国科学院心理研究所 IPCAS</p>
        <h1>视觉与注意课题组 在线招募平台</h1>
        <p class="subtitle">
          注册、登录、完善信息并进行实验报名。您的个人信息将仅用于实验参与管理和报酬发放。
        </p>
      </div>
      <div class="logo-bar">
        <div class="logo-square left-logo"><img src="assets/V&A_logo.png" alt="Lab" /></div>
        <div class="logo-square right-logo"><img src="assets/IPCAS_logo.png" alt="IPCAS" /></div>
      </div>
    </header>

    <main>
      <section class="card" id="auth">
        <div class="card-header">
          <h2>感谢参与招募，注册登录后即可报名实验</h2>
        </div>

        <div class="tab-row">
          <button class="tab active" data-tab="register">注册</button>
          <button class="tab" data-tab="login">登录</button>
        </div>

        <div class="tab-panel active" id="tab-register">
          <form id="registerForm" class="form-grid">
            <label>
              姓名
              <input name="name" required />
            </label>
            <label>
              密码
              <input name="password" type="password" minlength="6" required placeholder="注意留存、无法找回" />
            </label>
            <label>
              确认密码
              <input name="password_confirm" type="password" minlength="6" required />
            </label>
            <label>
              所在学校/单位全称
              <div class="autocomplete">
                <input name="unit" id="unitInput" required placeholder="如无联想结果，直接输入" autocomplete="off" />
                <div class="autocomplete-list" id="unitSuggestions"></div>
              </div>
            </label>
            <label>
              身份证号
              <input name="idcard" required />
            </label>
            <label>
              收款支付宝绑定手机号
              <input name="alipay_phone" required />
            </label>
            <label class="consent-check">
              <input type="checkbox" name="consent" required />
              <span>我已阅读并同意《信息收集与使用告知》</span>
            </label>
            <button type="submit" class="primary">提交注册</button>
          </form>
          <p class="form-note" id="registerStatus"></p>
        </div>

        <div class="tab-panel" id="tab-login">
          <form id="loginForm" class="form-grid">
            <label>
              系统内ID / 身份证号
              <input name="credential" placeholder="U123456 或 18位身份证号" />
            </label>
            <label>
              密码
              <input name="password" type="password" required />
            </label>
            <button type="submit" class="primary">登录</button>
          </form>
          <p class="form-note" id="loginStatus"></p>
        </div>
      </section>

      <section class="card hidden" id="profile">
        <div class="card-header">
          <h2>个人主页</h2>
          <p>登录后可更新信息并报名实验。</p>
        </div>
        <div id="profileEmpty" class="empty-state">
          <p>请先登录以查看个人信息。</p>
        </div>
        <div id="profileArea" class="hidden">
          <div class="profile-summary">
            <div>
              <p class="eyebrow">当前登录</p>
              <h3 id="profileName"></h3>
              <p id="profileUid"></p>
              <p id="profileMeta"></p>
            </div>
            <div class="profile-actions">
              <button id="changePasswordBtn" class="ghost">更新密码</button>
              <button id="logoutBtn" class="ghost">退出登录</button>
            </div>
          </div>

          <div id="passwordPanel" class="password-panel hidden">
            <div class="password-panel-header">
              <h4>更新密码</h4>
              <button type="button" class="ghost" id="passwordPanelClose">关闭</button>
            </div>
            <form id="passwordForm" class="form-grid">
              <label>
                新密码
                <input name="new_password" type="password" minlength="6" required />
              </label>
              <label>
                确认新密码
                <input name="new_password_confirm" type="password" minlength="6" required />
              </label>
              <div id="rootPasswordSection" class="inline-two hidden">
                <label>
                  目标被试ID
                  <input name="target_user_uid" placeholder="U000123" />
                </label>
                <label>
                  Root密码确认
                  <input name="root_password" type="password" />
                </label>
              </div>
              <button type="submit" class="primary">提交更新</button>
              <p class="form-note" id="passwordStatus"></p>
            </form>
          </div>

          <div id="contactPanel" class="password-panel hidden">
            <div class="password-panel-header">
              <h4>更新联系方式</h4>
            </div>
            <form id="contactForm" class="form-grid">
              <label>
                手机号
                <input name="alipay_phone" required />
              </label>
              <label>
                微信号
                <input name="wechat" />
              </label>
              <button type="submit" class="primary">保存更新</button>
              <p class="form-note" id="contactStatus"></p>
            </form>
          </div>

          <div class="split">
            <div class="profile-pane" id="profilePane">
              <div class="profile-pane-header">
                <h4>更新个人信息</h4>
                <button type="button" class="ghost" id="profileToggle">收起</button>
              </div>
              <form id="profileForm" class="form-grid">
              <label>
                收款支付宝绑定手机号
                <input name="alipay_phone" required />
              </label>
              <label>
                所在学校/单位全称
                <input name="unit" required />
              </label>
              <label>
                所学专业
                <div class="multi-select" id="majorSelect">
                  <div class="multi-tags" id="majorTags"></div>
                  <input id="majorInput" placeholder="输入后回车添加，可多选" autocomplete="off" />
                  <div class="autocomplete-list" id="majorSuggestions"></div>
                </div>
                <input type="hidden" name="majors_json" id="majorHidden" />
                <span class="hint">可多选；可填写；选择“无”将清空其他选项</span>
              </label>
              <label>
                职业
                <select name="occupation">
                  <option value="">请选择</option>
                  <option value="学生">学生</option>
                  <option value="在职">在职</option>
                  <option value="待业">待业</option>
                  <option value="退休">退休</option>
                  <option value="其他">其他</option>
                </select>
              </label>
              <label>
                微信号
                <input name="wechat" />
              </label>
              <label>
                所在省份
                <select name="region" id="provinceSelect">
                  <option value="">请选择</option>
                  <option value="北京市">北京市</option>
                  <option value="天津市">天津市</option>
                  <option value="河北省">河北省</option>
                  <option value="山西省">山西省</option>
                  <option value="内蒙古自治区">内蒙古自治区</option>
                  <option value="辽宁省">辽宁省</option>
                  <option value="吉林省">吉林省</option>
                  <option value="黑龙江省">黑龙江省</option>
                  <option value="上海市">上海市</option>
                  <option value="江苏省">江苏省</option>
                  <option value="浙江省">浙江省</option>
                  <option value="安徽省">安徽省</option>
                  <option value="福建省">福建省</option>
                  <option value="江西省">江西省</option>
                  <option value="山东省">山东省</option>
                  <option value="河南省">河南省</option>
                  <option value="湖北省">湖北省</option>
                  <option value="湖南省">湖南省</option>
                  <option value="广东省">广东省</option>
                  <option value="广西壮族自治区">广西壮族自治区</option>
                  <option value="海南省">海南省</option>
                  <option value="重庆市">重庆市</option>
                  <option value="四川省">四川省</option>
                  <option value="贵州省">贵州省</option>
                  <option value="云南省">云南省</option>
                  <option value="西藏自治区">西藏自治区</option>
                  <option value="陕西省">陕西省</option>
                  <option value="甘肃省">甘肃省</option>
                  <option value="青海省">青海省</option>
                  <option value="宁夏回族自治区">宁夏回族自治区</option>
                  <option value="新疆维吾尔自治区">新疆维吾尔自治区</option>
                  <option value="香港特别行政区">香港特别行政区</option>
                  <option value="澳门特别行政区">澳门特别行政区</option>
                  <option value="台湾">台湾</option>
                </select>
              </label>
              <label>
                左眼近视度数
                <input name="left_myopia" />
              </label>
              <label>
                右眼近视度数
                <input name="right_myopia" />
              </label>
              <label>
                民族
                <input name="ethnicity" />
                <span class="hint">提交后不可修改，如需更正请联系管理员</span>
              </label>
              <label>
                左/右利手
                <select name="handedness">
                  <option value="">请选择</option>
                  <option value="左利手">左利手</option>
                  <option value="右利手">右利手</option>
                  <option value="双利手">双利手</option>
                </select>
              </label>
              <label>
                受教育年限
                <input name="education_years" />
              </label>
              <label>
                身高 (cm)
                <input name="height_cm" />
              </label>
              <label>
                体重 (kg)
                <input name="weight_kg" />
              </label>
              <label>
                头围 (cm)
                <input name="head_circumference_cm" />
              </label>
              <div class="inline-two">
                <label>
                  是否有金属植入物
                  <span class="hint">如含金属成分的假牙/种植牙、金属内固定、起搏器、植入式助听器等</span>
                  <select name="metal_implant">
                    <option value="">请选择</option>
                    <option value="无">无</option>
                    <option value="有">有</option>
                  </select>
                </label>
                <label>
                  是否幽闭恐惧
                  <span class="hint">如密闭空间焦虑、呼吸急促、明显不适等</span>
                  <select name="claustrophobia">
                    <option value="">请选择</option>
                    <option value="无">无</option>
                    <option value="有">有</option>
                  </select>
                </label>
              </div>
              <button type="submit" class="primary">保存更新</button>
              <p class="form-note" id="profileStatus"></p>
              </form>
            </div>

            <form id="experimentForm" class="experiment-panel">
              <h4>实验报名</h4>
              <div class="experiment-list">
                <p class="hint">您暂无可报名实验。若新增实验或名额，将在此处显示可报名的实验列表。</p>
              </div>
              <button type="submit" class="primary">提交报名</button>
              <p class="form-note" id="experimentStatus"></p>
            </form>
            <div class="experiment-panel" id="appliedExperimentsPanel">
              <h4>已报名的实验</h4>
              <div class="experiment-list" id="appliedExperimentList">
                <p class="hint">暂无已报名实验。</p>
              </div>
            </div>
          </div>

          <div id="adminArea" class="admin-area hidden">
            <div class="admin-tabs" id="adminTabs">
              <button class="tab active" data-admin-tab="new">新实验</button>
            </div>
            <div class="admin-panel active" id="adminPanelNew">
              <div class="admin-layout">
                <div class="admin-left">
                  <label>
                    入组条件
                    <textarea id="adminConditions" rows="4">年龄>=18
左/右利手=右</textarea>
                  </label>
                  <label>
                    名额分配
                    <textarea id="adminQuota" rows="4">性别=男*10 & =女*10
年龄[18,30)*20 & >30*0 & [0,18)*0
左/右利手=右*20</textarea>
                  </label>
                  <div class="info-card" id="quotaHelpBubble">
                    <strong>设置说明（入组条件 + 名额分配）</strong>
                    <p>1) 入组条件写法：字段 + 比较符号 + 值；支持 <span class="mono">=</span>、<span class="mono">!=</span>、<span class="mono">≠</span>、<span class="mono">&gt;</span>、<span class="mono">&lt;</span>、<span class="mono">&gt;=</span>、<span class="mono">&lt;=</span>；使用 <span class="mono">&</span> 表示同时满足，<span class="mono">|</span> 表示二选一，括号用于分组。</p>
                    <p>可用字段：<span class="mono">年龄</span>、<span class="mono">所在地区</span>、<span class="mono">左/右利手</span>、<span class="mono">左眼近视度数</span>、<span class="mono">右眼近视度数</span>、<span class="mono">民族</span>、<span class="mono">职业</span>、<span class="mono">专业</span>、<span class="mono">受教育年限</span>、<span class="mono">身高</span>、<span class="mono">体重</span>、<span class="mono">头围</span>、<span class="mono">参与过</span>。</p>
                    <p>示例：<span class="mono">年龄>=18 & 年龄<30 & (左眼近视度数<600|右眼近视度数<600)</span></p>
                    <p>示例：<span class="mono">专业!=心理学类</span> 或 <span class="mono">职业=学生</span></p>
                    <p>示例：<span class="mono">参与过!=E000001</span> 或 <span class="mono">参与过=眼动</span></p>
                    <p>提示：<span class="mono">专业</span> 为多选字段，<span class="mono">=</span> 表示包含该项，<span class="mono">!=</span> 表示不包含该项。</p>
                    <p>2) 名额分配写法：每行是一组配额；同一行内用 <span class="mono">&</span> 连接多个条件；<span class="mono">条件*人数</span>；使用 <span class="mono">ALL*20</span> 表示不限条件。</p>
                    <p>区间写法：<span class="mono">年龄[18,30)</span> 表示 $18\le \text{年龄}<30$；<span class="mono">[</span> 与 <span class="mono">]</span> 表示包含，<span class="mono">(</span> 与 <span class="mono">)</span> 表示不包含。</p>
                    <p>示例：<span class="mono">性别=男*10 & =女*10</span></p>
                    <p>示例：<span class="mono">专业=心理学类*10 & =法学类*10</span></p>
                    <p>示例：<span class="mono">年龄[18,30)*20 & >30*0 & [0,18)*0</span></p>
                    <p class="hint">注意：入组条件与名额分配需同时满足，条件之间不可冲突。</p>
                  </div>
                </div>
                <div class="admin-right">
                  <form id="adminExperimentForm" class="form-grid">
                    <label>
                      主试联系方式（手机号）
                      <input name="contact_phone" id="adminContactPhone" required />
                    </label>
                    <label>
                      实验名称
                      <input name="name" required />
                    </label>
                    <label>
                      实验类型
                      <select name="type" required>
                        <option value="">请选择</option>
                        <option value="行为">行为</option>
                        <option value="EEG">EEG</option>
                        <option value="MEG">MEG</option>
                        <option value="MRI">MRI</option>
                        <option value="NIRS">NIRS</option>
                        <option value="眼动">眼动</option>
                        <option value="TSM">TSM</option>
                        <option value="其他">其他</option>
                      </select>
                    </label>
                    <label>
                      地点
                      <select name="location" id="locationSelect">
                        <option value="在线">在线</option>
                        <option value="604-2">604-2</option>
                        <option value="604-3">604-3</option>
                        <option value="604-4">604-4</option>
                        <option value="604-5">604-5</option>
                        <option value="其他">其他</option>
                      </select>
                    </label>
                    <label id="locationCustomField" class="hidden">
                      自定义地点
                      <input name="location_custom" />
                    </label>
                    <div class="upload-tabs hidden" id="uploadTabs">
                      <button type="button" class="mini-tab active" data-upload-tab="link">实验链接</button>
                      <button type="button" class="mini-tab" data-upload-tab="upload">在线实验文件夹</button>
                    </div>
                    <div class="upload-panel" id="uploadPanelLink">
                      <label id="locationLinkField">
                        实验链接
                        <input name="location_link" />
                      </label>
                    </div>
                    <div class="upload-panel hidden" id="uploadPanelUpload">
                      <div class="upload-block" id="hostedUploadField">
                        <span class="upload-title">在线实验文件夹</span>
                        <div class="upload-zone" id="uploadZone">
                          <input type="file" id="uploadFolderInput" webkitdirectory directory multiple />
                          <div class="upload-zone-text">拖拽文件夹到这里，或点击选择文件夹</div>
                          <div class="upload-zone-meta" id="uploadZoneMeta">需包含 index.html</div>
                        </div>
                        <div class="upload-status" id="uploadStatus"></div>
                        <p class="hint">上传后自动生成在线链接。</p>
                      </div>
                      <label id="downloadPolicyField">
                        数据保存方式
                        <select name="download_policy" id="downloadPolicy">
                          <option value="download_and_upload">同时上传到服务器并下载到本地</option>
                          <option value="upload_only">仅上传到服务器</option>
                          <option value="download_only">仅下载到本地（不推荐）</option>
                        </select>
                        <span class="hint">选择“仅上传到服务器”将拦截所有下载行为，并把下载请求记录到服务器。</span>
                      </label>
                    </div>
                    <label id="accessControlModeField" class="hidden">
                      在线访问控制
                      <select name="access_control_mode" id="accessControlMode">
                        <option value="none" data-hint="原链接：直接呈现/跳转原链接，被试将能在任意时刻/设备访问该链接。">否（原链接）</option>
                        <option value="proxy" data-hint="反向代理：隐藏原链接，但不适合频繁和源传输数据的动态网页。">是（反向代理）</option>
                        <option value="token" data-hint="拼接令牌：需要在实验页面 head 添加脚本校验 token。">是（拼接令牌）</option>
                      </select>
                      <span class="hint" id="accessControlHint">原链接：直接呈现/跳转原链接，被试将能在任意时刻/设备访问该链接。</span>
                    </label>
                    <div class="info-card hidden" id="tokenScriptHelp">
                      <strong>拼接令牌操作说明</strong>
                      <p class="hint">将脚本粘贴到实验页面 <span class="mono">head</span> 内（建议放在最前面）。二选一：</p>
                      <div class="script-pair">
                        <div class="script-card">
                          <div class="script-title">方案 A（遮罩验证，推荐）</div>
                          <p class="hint">进入页面先显示验证遮罩，通过后自动放行。</p>
                          <button type="button" class="ghost" data-copy-script="mask">复制脚本</button>
                        </div>
                        <div class="script-card">
                          <div class="script-title">方案 B（直接阻断）</div>
                          <p class="hint">直接隐藏页面，验证失败则显示错误提示。</p>
                          <button type="button" class="ghost" data-copy-script="block">复制脚本</button>
                        </div>
                      </div>
                    </div>
                    <fieldset class="checkbox-group" id="allowedDevicesField">
                      <legend>允许设备</legend>
                      <label><input type="checkbox" name="allowed_devices" value="desktop" checked />电脑</label>
                      <label><input type="checkbox" name="allowed_devices" value="tablet" checked />平板</label>
                      <label><input type="checkbox" name="allowed_devices" value="mobile" checked />手机</label>
                    </fieldset>
                    <label>
                      内容简介
                      <textarea name="description" rows="3"></textarea>
                    </label>
                    <label>
                      注意事项
                      <textarea name="notes" rows="1" class="note-input"></textarea>
                    </label>
                    <label>
                      预计时长（分钟）
                      <input name="duration_min" type="number" min="1" required />
                    </label>
                    <label>
                      报酬
                      <input name="reward" required />
                    </label>
                    <label>
                      按时间段预约
                      <select name="schedule_required" id="scheduleRequired">
                        <option value="yes">是</option>
                        <option value="no">否</option>
                      </select>
                    </label>
                    <label id="scheduleSlotsRequiredField">
                      预约时间段数量
                      <input name="schedule_slots_required" id="scheduleSlotsRequired" value="=1" />
                    </label>
                    <button type="submit" class="primary">确认发布实验</button>
                    <p class="form-note" id="adminExperimentStatus"></p>
                  </form>
                </div>
              </div>
              <div class="schedule-editor hidden full-width" id="scheduleEditor">
                <div class="schedule-header">
                  <button type="button" class="ghost" id="schedulePrev">◀</button>
                  <div id="scheduleTitle"></div>
                  <button type="button" class="ghost" id="scheduleNext">▶</button>
                  <button type="button" class="ghost" id="scheduleUp">▲</button>
                  <button type="button" class="ghost" id="scheduleDown">▼</button>
                  <button type="button" class="ghost" id="scheduleFill">一键填充</button>
                  <button type="button" class="ghost" id="scheduleRefresh">刷新</button>
                </div>
                <div class="schedule-grid" id="scheduleGrid"></div>
              </div>
            </div>
            <div class="admin-panel" id="adminPanelExperiments"></div>
          </div>
        </div>
      </section>

      <section class="card admin-experiments hidden" id="adminExperiments">
        <div class="card-header">
          <h2>实验与被试管理</h2>
          <button class="ghost" id="adminExperimentsRefresh">刷新列表</button>
        </div>
        <div id="adminExperimentList" class="admin-experiment-list"></div>
      </section>

      <section class="card consent-section" id="consent">
        <h2>信息收集与使用告知</h2>
        <div class="consent-body">
          <p>
            您的数据安全是我们的首要责任。我们严格遵守《个人信息保护法》和科研伦理规范，采用多重技术手段保护您的隐私。
          </p>
          <h3>我们收集哪些数据</h3>
          <p>
            认知测试数据（反应时、正确率、操作序列等行为指标）、任务行为数据（任务创建、修改、完成时间等操作记录）、
            反思内容数据（文本、情绪评分、事件记录等）、问卷响应数据（问卷答案、填写时长等）。
            我们不会收集设备信息、位置信息或通讯录等与研究无关的数据。
          </p>
          <p>
            我们将收集您在注册与实验报名过程中提交的身份信息、联系方式及相关背景资料，用于科研被试管理、资格核验、
            参与记录、报酬结算与安全合规目的。我们仅在实现上述目的的最小范围内处理您的信息，并采取加密、权限控制等全面措施保护您的隐私。
          </p>
          <h3>数据如何使用与保护</h3>
          <p>
            匿名化处理：所有数据在存储前已脱敏，使用随机ID标识，无法关联到个人身份信息。
            加密传输：采用 HTTPS 与 TLS 1.3 加密协议，防止传输过程中被窃取。
            访问控制：仅授权研究人员可访问数据，所有访问操作均有审计日志。
            学术用途：数据仅用于科学研究，发表论文时仅呈现统计分析结果，不包含个人数据。
          </p>
          <h3>您的权利</h3>
          <p>
            查阅权：您可以随时查看自己产生的所有数据。
            导出权：研究结束后可申请导出个人数据副本。
            撤回权：您可以随时退出研究，已采集的数据将在7日内删除。
            咨询权：对数据使用有任何疑问，可联系研究团队咨询。
          </p>
          <p>
            您提交信息即表示已阅读并理解本告知内容，并同意我们按照告知范围处理您的个人信息。若不同意，请勿继续提交注册。
          </p>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <p>IPCAS 视觉与注意课题组 · 在线被试管理系统</p>
      <p>© 2026 IPCAS · 更新时间：2026年2月27日 14:30</p>
      <p> 联系方式：luyx@psych.ac.cn</p> 
    </footer>

    <script src="app.js"></script>
  </body>
</html>
